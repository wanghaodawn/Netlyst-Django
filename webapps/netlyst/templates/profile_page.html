{% extends "home_page_base.html" %}

{% block title %}
<title> Profile - Netlyst </title>

<style>
  html, body {
    height: 100%;
    width: 100%;
    margin: 0px;
    padding: 0px;
  }
  #map {
    width: 600px;
    height: 300px;
    margin-left: 0px;
    margin-right: 0px;
    margin-top: 50px;
    margin-bottom: 0px;
    border:1px solid #E0E0E0;
  }
  p.personal_info {
    font-family: Arial;
    font-size: 14px;
    color: #6F6F70;
    margin-left: 130px;
  }


body {
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}

.day {
  fill: #fff;
  stroke: #ccc;
}

.month {
  fill: none;
  stroke: #000;
  stroke-width: 2px;
}

.RdYlGn .q0-11{fill:rgb(165,0,38)}
.RdYlGn .q1-11{fill:rgb(215,48,39)}
.RdYlGn .q2-11{fill:rgb(244,109,67)}
.RdYlGn .q3-11{fill:rgb(253,174,97)}
.RdYlGn .q4-11{fill:rgb(254,224,139)}
.RdYlGn .q5-11{fill:rgb(255,255,191)}
.RdYlGn .q6-11{fill:rgb(217,239,139)}
.RdYlGn .q7-11{fill:rgb(166,217,106)}
.RdYlGn .q8-11{fill:rgb(102,189,99)}
.RdYlGn .q9-11{fill:rgb(26,152,80)}
.RdYlGn .q10-11{fill:rgb(0,104,55)}

</style>


{% load static from staticfiles %}
<script src="{% static 'js/d3.min.js' %}"> </script>
{% endblock %}

{% block content %}
{% load static from staticfiles %}
<script src="{% static 'js/jquery-2.1.4.min.js' %}" type="text/javascript"></script>


<input type="hidden" id="curr_user_lat" value={{curr_user_lat}}></input>
<input type="hidden" id="curr_user_lng" value={{curr_user_lat}}></input>

<input type="hidden" id="post0_lat" value={{post0_lat}}></input>
<input type="hidden" id="post0_lng" value={{post0_lng}}></input>
<input type="hidden" id="post1_lat" value={{post1_lat}}></input>
<input type="hidden" id="post1_lng" value={{post1_lng}}></input>
<input type="hidden" id="post2_lat" value={{post2_lat}}></input>
<input type="hidden" id="post2_lng" value={{post2_lng}}></input>
<input type="hidden" id="post3_lat" value={{post3_lat}}></input>
<input type="hidden" id="post3_lng" value={{post3_lng}}></input>
<input type="hidden" id="post4_lat" value={{post4_lat}}></input>
<input type="hidden" id="post4_lng" value={{post4_lng}}></input>
<input type="hidden" id="post5_lat" value={{post5_lat}}></input>
<input type="hidden" id="post5_lng" value={{post5_lng}}></input>
<input type="hidden" id="post6_lat" value={{post6_lat}}></input>
<input type="hidden" id="post6_lng" value={{post6_lng}}></input>
<input type="hidden" id="post7_lat" value={{post7_lat}}></input>
<input type="hidden" id="post7_lng" value={{post7_lng}}></input>
<input type="hidden" id="post8_lat" value={{post8_lat}}></input>
<input type="hidden" id="post8_lng" value={{post8_lng}}></input>
<input type="hidden" id="post9_lat" value={{post9_lat}}></input>
<input type="hidden" id="post9_lng" value={{post9_lng}}></input>

<input type="hidden" id="post10_lat" value={{post10_lat}}></input>
<input type="hidden" id="post10_lng" value={{post10_lng}}></input>
<input type="hidden" id="post11_lat" value={{post11_lat}}></input>
<input type="hidden" id="post11_lng" value={{post11_lng}}></input>
<input type="hidden" id="post12_lat" value={{post12_lat}}></input>
<input type="hidden" id="post12_lng" value={{post12_lng}}></input>
<input type="hidden" id="post13_lat" value={{post13_lat}}></input>
<input type="hidden" id="post13_lng" value={{post13_lng}}></input>
<input type="hidden" id="post14_lat" value={{post14_lat}}></input>
<input type="hidden" id="post14_lng" value={{post14_lng}}></input>
<input type="hidden" id="post15_lat" value={{post15_lat}}></input>
<input type="hidden" id="post15_lng" value={{post15_lng}}></input>
<input type="hidden" id="post16_lat" value={{post16_lat}}></input>
<input type="hidden" id="post16_lng" value={{post16_lng}}></input>
<input type="hidden" id="post17_lat" value={{post17_lat}}></input>
<input type="hidden" id="post17_lng" value={{post17_lng}}></input>
<input type="hidden" id="post18_lat" value={{post18_lat}}></input>
<input type="hidden" id="post18_lng" value={{post18_lng}}></input>
<input type="hidden" id="post19_lat" value={{post19_lat}}></input>
<input type="hidden" id="post19_lng" value={{post19_lng}}></input>

<table>
  <tr>
    <td class="navbar">
      {% load static from staticfiles %}
      <a href="{% url 'global' %}"><img src="{% static 'images/logo1_blue.png' %}" class="navbar_logo"></a>
    </td>

    <td class="navbar">
      <form class="form-search">
        <input type="text" class="round_corner_search" placeholder="Search"></input>
      </form>
    </td>

    <td class="navbar">
      <p class="navbar_username">
        <a href="{% url 'django.contrib.auth.views.logout_then_login' %}" type = "submit">Log Out</a>
      </p>
    </td>

  </tr>
</table>

<!--BEGIN infocaptor_embed This is the embedable widget,just paste the code from BEGIN...END.Powered by http://www.infocaptor.com-->
<!-- <div>
  <iframe scrolling="no" frameborder=0 
src="http://www.infocaptor.com/bubble-my-page?size=800&mode=embed&url=http://15462.courses.cs.cmu.edu/fall2015/" width=800 height=830>
  </iframe>
</div> -->
<!--END infocaptor_embed-->


<div class="background_lightgrey">
  <hr>


  <br /><br /><br />

  <table>
    <tr>
      <td class="profile_layer1_left">
        {% if info.picture %}
        <img src="{{ info.picture.url }}" class="img-circle" alt="{{form.first_name.value}} {{form.last_name.value}}" width="130px" height="130px">
        {% endif %}

      </td>
      <td class="profile_layer1_right">

        <table>
          <tr>
            <td>
              <p class="big_username">
                {{current_user.username}} 
              </p>
            </td>
            {% if login_user.id = current_user.id %}
            <td>
              <a href="{% url 'edit' %}" class="edit_button">

                <button type="submit" class="edit_profile_button">
                  EDIT PROFILE
                </button>
              </a>
            </td>
            {% else %}
            <td>
              {% if is_following == False %}
                  <form method="post" action="{% url 'follow' current_user.id %}">
                    <button type="submit" class="edit_profile_button">
                      FOLLOW
                    </button>
                    {% csrf_token %}
                  </form>
                {% else %}
                  <form method="post" action="{% url 'unfollow' current_user.id %}">
                    <button type="submit" class="edit_profile_button">
                      UNFOLLOW
                    </button>
                    {% csrf_token %}
                  </form>
                {% endif %}
              </td>
            {% endif %}
            <td>
            </td>
          </tr>

        </table>



        <p class="profile_info">
          {{postnum}} Posts
          &nbsp;&nbsp;&nbsp;&nbsp;
          {{f_er_num}}
          <a href="{% url 'follow_page' current_user.id %}"> Followers </a>
          &nbsp;&nbsp;&nbsp;&nbsp;
          {{f_ee_num}}
          <a href="{% url 'follow_page' current_user.id %}"> Followings </a>
          &nbsp;&nbsp;&nbsp;&nbsp;
           
          <a href="{% url 'groupstream' %}">Groups</a>
          &nbsp;&nbsp;&nbsp;&nbsp;
          
          <a href="{% url 'visitorinfo' current_user.id %}"> Visitors</a>
          
          <a href = "{% url 'album' current_user.id %}"> ALBUM </a>
          &nbsp;&nbsp;&nbsp;&nbsp; 
          <a href="/word_cloud/"> WORDLE </a>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <br />
         {% if login_user.id = current_user.id %}
            <a href="{% url 'messages_inbox'%}"> INBOX </a>
            {% load inbox %}
            {% inbox_count %}
            &nbsp;&nbsp;&nbsp;&nbsp;
            <a href="{% url 'messages_outbox' %}"> OUTBOX </a>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <a href="{% url 'messages_compose' %}"> COMPOSE </a>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <a href="{% url 'messages_trash' %}"> TRASH </a>
            &nbsp;&nbsp;&nbsp;&nbsp;
         {% else %}
            <a href="{% url 'report_spam' current_user.id %}"> Report Spam </a>
         {% endif %}
        </p>
      </table>


      <table>
        <br />
        {% if current_user.info.gender %}
          <tr>
            <td></td>
            <td>
              <p class="personal_info">
                {{current_user.info.age}} year's old
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                {{current_user.info.gender}}
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                {{current_user.info.race}}
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                Smile: {{current_user.info.smile}}%
              </p>
            </td>
            <td></td>
          </tr>
        {% endif %}
        <br />
        <tr>
          <td></td>
          <td>
            <div id="map">
            </div>

<!--        <input type="text" id="posts_lat" name="posts_lat" value={{posts_lat}}>
            <input type="text" id="posts_lng" name="posts_lng" value={{posts_lng}}>
 -->
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdgarKz8i6GBpd6x_9aiTRY-uUSiWREHM&signed_in=false&callback=initMap">
            </script>
            <script>
              function initMap() {
                // Specify features and elements to define styles.
                var styleArray = [
                  {
                    featureType: "all",
                    stylers: [
                     { saturation: -80 }
                    ]
                  },{
                    featureType: "road.arterial",
                    elementType: "geometry",
                    stylers: [
                      { hue: "#00ffee" },
                      { saturation: 50 }
                    ]
                  },{
                    featureType: "poi.business",
                    elementType: "labels",
                    stylers: [
                      { visibility: "off" }
                    ]
                  }
                ];
                
                // New map
                var user_position = { lat: {{curr_user_lat}}, lng: {{curr_user_lng}} };
                console.log("user_position");
                console.log(user_position);
                var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 12,
                  styles: styleArray,
                  center: user_position
                });
                
                // The position of current user
                {% load static from staticfiles %}
                var user_image = "{% static 'images/map_flag.png' %}";
                var user_marker = new google.maps.Marker({
                  position: user_position,
                  map: map,
                  icon: user_image
                });

                // The distribution and density of posts
                var post_image = "{% static 'images/map_feet.png' %}";
                var postnum = {{postnum}};
                console.log("post_position");
                var lat = [];
                var lng = [];
                for (var i = 0; i < postnum; i++) {
                  if (document.getElementById("post" + i + "_lat") && 
                      document.getElementById("post" + i + "_lat").getAttribute("value") &&
                      document.getElementById("post" + i + "_lng") &&
                      document.getElementById("post" + i + "_lng").getAttribute("value")) {
                    lat[i] = parseFloat(document.getElementById("post" + i + "_lat").getAttribute("value"));
                    lng[i] = parseFloat(document.getElementById("post" + i + "_lng").getAttribute("value"));
                    var post_position = { lat: lat[i], lng: lng[i]};
                    console.log(post_position);
                    
                    var user_marker = new google.maps.Marker({
                      position: post_position,
                      map: map,
                      title: 'post' + i + 'position',
                      icon: post_image
                    });

                    var cityCircle = new google.maps.Circle({
                      strokeColor: '#647864',
                      strokeOpacity: 0.6,
                      strokeWeight: 2,
                      fillColor: '#647864',
                      fillOpacity: 0.35,
                      map: map,
                      center: post_position,
                      radius: 1500
                    });
                  }                
                }

              }
              </script>
          </td>
          <td></td>
        </tr>
      </table>

      {% for post in posts %}
      <table class="table_items">
        <tr>
          <td class="td_items">
            <img src = "{% url 'photo' post.user.id %}" class="img-circle" alt="{{form.first_name.value}} {{form.last_name.value}}" width="50px" height="50px">
            <a href="{% url 'viewprofile' post.user.id %}" name = "user">{{post.user.username}}</a>
            {{post.date|date:"F j, g:i a"}}
          </td>
        </tr>
        <tr>
          <td class="td_items">
            <hr>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="{% url 'post_pos_val' post.id %}">{{post.text}}</a>
            <br /><br />
          </td>
        </tr>
        <tr>
          {% if post.picture %}
          <td class="td_items">
            <img src = "{% url 'postphoto' post.id %}" width="600px" height="600px">
          </td>
          {% else %}
          {% endif %}
        </tr><br /><br /><br /><br />
        <tr>
          <td class="td_items">
          {% if curr_post == post %}
            {% if is_like == True %}
              <form method="post" action="{% url 'unlike' post.id %}">
                <button type="submit" class="like_button">
                  UNLIKE&nbsp;{{post.likenum}}
                </button>
                {% csrf_token %}
              </form>
              {% else %}
              <form method="post" action="{% url 'like' post.id %}">
                <button type="submit" class="like_button">
                  LIKE&nbsp;{{post.likenum}}
                </button>
                {% csrf_token %}
              </form>
            {% endif %}
          {% else %}
            <form method="post" action="{% url 'like' post.id %}">
              <button type="submit" class="like_button">
                LIKE&nbsp;{{post.likenum}}
              </button>
              {% csrf_token %}
            </form>
          {% endif %}
            <br />
          </td>
        </tr>
      </table>
      {% endfor %}
      


    <script class="calendar">
      var width = 970,
          height = 136,
          cellSize = 17; // cell size

      var percent = d3.format(".1%"),
          format = d3.time.format("%Y-%m-%d");

      var color = d3.scale.quantize()
          .domain([-.05, .05])
          .range(d3.range(11).map(function(d) { return "q" + d + "-11"; }));

      var svg = d3.select("body").selectAll("svg")
          .data(d3.range(2015, 2016))
        .enter().append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("class", "RdYlGn")
        .append("g")
          .attr("transform", "translate(" + ((width - cellSize * 53) / 2) + "," + (height - cellSize * 7 - 1) + ")");

        svg.append("text")
            .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
            .style("text-anchor", "middle")
            .text(function(d) { return d; });

        var rect = svg.selectAll(".day")
            .data(function(d) { return d3.time.days(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
          .enter().append("rect")
            .attr("class", "day")
            .attr("width", cellSize)
            .attr("height", cellSize)
            .attr("x", function(d) { return d3.time.weekOfYear(d) * cellSize; })
            .attr("y", function(d) { return d.getDay() * cellSize; })
            .datum(format);

        rect.append("title")
            .text(function(d) { return d; });

        svg.selectAll(".month")
            .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
          .enter().append("path")
            .attr("class", "month")
            .attr("d", monthPath);

        d3.csv("{% url 'calender' current_user.id %}", function(error, csv) {
          if (error) throw error;

          var data = d3.nest()
            .key(function(d) { return d.Date; })
            .rollup(function(d) { return -d[0].Open/1000; })
            .map(csv);

          rect.filter(function(d) { return d in data; })
              .attr("class", function(d) { return "day " + color(data[d]); })
            .select("title")
              .text(function(d) { return d + ": " + percent(data[d]); });
        });

        function monthPath(t0) {
          var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
              d0 = t0.getDay(), w0 = d3.time.weekOfYear(t0),
              d1 = t1.getDay(), w1 = d3.time.weekOfYear(t1);
          return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
              + "H" + w0 * cellSize + "V" + 7 * cellSize
              + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
              + "H" + (w1 + 1) * cellSize + "V" + 0
              + "H" + (w0 + 1) * cellSize + "Z";
        }
        d3.select(self.frameElement).style("height", "2910px");
      </script>



    <br /><br /><br />
        <p class="bottom_small_blue">
          <a href="#">ABOUT US</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">SUPPORT</a>&nbsp;&nbsp;&nbsp;
          <a href="#">BLOG</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">PRESS</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">API</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">JOBS</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">PRIVACY</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">TERMS</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#">LANGUAGE</a>
          <p class="bottom_small_black_right">© 2015 NETLYST</p>
        </p>
        <br />
      </div>


   {% endblock %}